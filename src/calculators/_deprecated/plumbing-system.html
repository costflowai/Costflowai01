<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
  <title>Plumbing System Calculator - Design & Size | CostFlowAI</title>
  <meta name="description" content="Calculate fixture units, size pipes, analyze pressure loss, and design water heater systems. Professional plumbing design calculator.">
  <link rel="canonical" href="https://costflowai.com/calculators/plumbing-system.html">
  <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print">
  <style>
    .calc-container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    .calc-header { text-align: center; margin-bottom: 2rem; }
    .quick-actions { display: flex; gap: 1rem; justify-content: center; margin: 1rem 0; }
    .calc-body { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    .input-section { background: #f7fafc; padding: 1.5rem; border-radius: 8px; }
    .results-section { background: white; border: 2px solid #e2e8f0; padding: 1.5rem; border-radius: 8px; }
    .input-group { margin-bottom: 1rem; }
    .input-group label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
    .input-group input, .input-group select { width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px; }
    .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; margin: 0.25rem; }
    .btn-primary { background: #ff6b35; color: white; }
    .btn-secondary { background: #e2e8f0; }
    .result-primary { font-size: 2rem; font-weight: bold; color: #1e3a5f; }
    .breakdown-table { width: 100%; margin-top: 1rem; }
    .breakdown-table td { padding: 0.5rem; border-bottom: 1px solid #e2e8f0; }
    .disclaimer { background: #fff5f5; border-left: 3px solid #ff6b35; padding: 1rem; margin-top: 2rem; }
    .fixture-section { background: #f9f9f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
    .material-comparison { background: #f0f9ff; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    .pressure-analysis { background: #fef7ed; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    .drain-section { background: #f6ffed; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    @media (max-width: 768px) { .calc-body { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <nav class="nav" role="navigation" aria-label="Main navigation">
      <a href="/">Home</a>
      <a href="/calculators/">Calculators</a>
      <a href="/blog/">Blog</a>
      <a href="/#contact">Contact</a>
      <a href="/#contact">üí¨ Feedback</a>
    </nav>
    
    <div class="header">
      <h1>üöø Plumbing System Calculator</h1>
      <p>Pipe sizing, fixture units, pressure analysis, and water heater sizing</p>
    </div>
  </header>
  
  <div class="calc-container" id="plumbing-calc" data-calc="plumbing">
    <div class="calc-header">
      <h2>Plumbing System Designer</h2>
      <p>Fixture units, pipe sizing, pressure analysis, and material cost comparison</p>
      <div class="quick-actions">
        <button class="btn btn-secondary" onclick="loadDefaults('residential')">Residential System</button>
        <button class="btn btn-secondary" onclick="loadDefaults('commercial')">Commercial System</button>
        <button class="btn btn-secondary" onclick="loadLastUsed()">Load Last Used</button>
      </div>
    </div>

    <div class="calc-body">
      <div class="input-section">
        <h3>Plumbing System Parameters</h3>
        
        <!-- System Type -->
        <div class="input-group">
          <label>System Type</label>
          <select id="systemType">
            <option value="residential" selected>Residential</option>
            <option value="commercial">Commercial</option>
            <option value="industrial">Industrial</option>
          </select>
        </div>

        <div class="input-group">
          <label>Water Supply Pressure (PSI)</label>
          <input type="number" id="supplyPressure" value="60" min="20" max="120">
        </div>

        <!-- Fixture Counts -->
        <div class="fixture-section">
          <h4>Water Supply Fixtures</h4>
          
          <div class="input-group">
            <label>Water Closets (Toilets)</label>
            <input type="number" id="toilets" value="3" min="0">
          </div>
          
          <div class="input-group">
            <label>Lavatories (Sinks)</label>
            <input type="number" id="lavatories" value="3" min="0">
          </div>

          <div class="input-group">
            <label>Kitchen Sinks</label>
            <input type="number" id="kitchenSinks" value="1" min="0">
          </div>

          <div class="input-group">
            <label>Laundry Tubs</label>
            <input type="number" id="laundryTubs" value="1" min="0">
          </div>

          <div class="input-group">
            <label>Bathtubs</label>
            <input type="number" id="bathtubs" value="2" min="0">
          </div>

          <div class="input-group">
            <label>Showers</label>
            <input type="number" id="showers" value="1" min="0">
          </div>

          <div class="input-group">
            <label>Dishwashers</label>
            <input type="number" id="dishwashers" value="1" min="0">
          </div>

          <div class="input-group">
            <label>Clothes Washers</label>
            <input type="number" id="washers" value="1" min="0">
          </div>
        </div>

        <!-- Pipe System Parameters -->
        <div class="fixture-section">
          <h4>Pipe System Design</h4>
          
          <div class="input-group">
            <label>Main Supply Line Length (feet)</label>
            <input type="number" id="mainLineLength" value="100" min="10">
          </div>
          
          <div class="input-group">
            <label>Average Branch Length (feet)</label>
            <input type="number" id="branchLength" value="25" min="5">
          </div>

          <div class="input-group">
            <label>Pipe Material</label>
            <select id="pipeMaterial">
              <option value="copper">Copper (Type L)</option>
              <option value="pex" selected>PEX</option>
              <option value="cpvc">CPVC</option>
              <option value="galvanized">Galvanized Steel</option>
            </select>
          </div>

          <div class="input-group">
            <label>Number of Floors</label>
            <input type="number" id="floors" value="2" min="1" max="5">
          </div>

          <div class="input-group">
            <label>Static Head (feet)</label>
            <input type="number" id="staticHead" value="20" min="0">
          </div>
        </div>

        <!-- Water Heater Sizing -->
        <div class="fixture-section">
          <h4>Water Heater Parameters</h4>
          
          <div class="input-group">
            <label>Number of Bedrooms</label>
            <input type="number" id="bedrooms" value="3" min="1" max="8">
          </div>
          
          <div class="input-group">
            <label>Number of Bathrooms</label>
            <input type="number" id="bathrooms" value="2" min="1" max="8">
          </div>

          <div class="input-group">
            <label>Fuel Type</label>
            <select id="fuelType">
              <option value="electric">Electric</option>
              <option value="gas" selected>Natural Gas</option>
              <option value="propane">Propane</option>
              <option value="solar">Solar + Backup</option>
            </select>
          </div>
        </div>

        <button class="btn btn-primary" onclick="calculate()" data-action="calculate" style="width: 100%; margin-top: 1rem;">Design System</button>
      </div>

      <div class="results-section">
        <h3>Plumbing Design Results</h3>
        
        <div style="text-align: center; padding: 1rem; background: #f7fafc; border-radius: 8px;">
          <div>Total Fixture Units</div>
          <div class="result-primary" id="totalFixtureUnits">0 DFU</div>
          <div style="color: #718096;" id="simultaneousLoad">Peak simultaneous demand</div>
        </div>

        <div style="text-align: center; padding: 1rem; margin-top: 1rem; background: #fff5f5; border-radius: 8px;">
          <div>Required Main Line</div>
          <div class="result-primary" id="mainPipeSize">1" Pipe</div>
          <div style="color: #718096;" id="flowRate">Based on flow requirements</div>
        </div>

        <h4 style="margin-top: 1.5rem;">Fixture Unit Breakdown (Supply)</h4>
        <table class="breakdown-table">
          <tr><td>Water Closets</td><td align="right" id="toiletDFU">0 DFU</td></tr>
          <tr><td>Lavatories</td><td align="right" id="lavDFU">0 DFU</td></tr>
          <tr><td>Kitchen Sinks</td><td align="right" id="kitchenDFU">0 DFU</td></tr>
          <tr><td>Bathtubs</td><td align="right" id="tubDFU">0 DFU</td></tr>
          <tr><td>Showers</td><td align="right" id="showerDFU">0 DFU</td></tr>
          <tr><td>Laundry</td><td align="right" id="laundryDFU">0 DFU</td></tr>
          <tr><td>Dishwashers</td><td align="right" id="dishwasherDFU">0 DFU</td></tr>
          <tr><td>Clothes Washers</td><td align="right" id="washerDFU">0 DFU</td></tr>
        </table>

        <div class="pressure-analysis">
          <h4>Pressure Loss Analysis</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <strong>Static Head Loss</strong>
              <div id="staticLoss">0.0 PSI</div>
              <div style="color: #718096; font-size: 0.9rem;">Elevation difference</div>
            </div>
            <div>
              <strong>Friction Loss</strong>
              <div id="frictionLoss">0.0 PSI</div>
              <div style="color: #718096; font-size: 0.9rem;">Pipe friction + fittings</div>
            </div>
          </div>
          <div style="margin-top: 1rem;">
            <strong>Available Pressure at Fixtures: <span id="availablePressure">60.0 PSI</span></strong>
            <div style="color: #718096;">Minimum required: 8 PSI</div>
          </div>
        </div>

        <div class="material-comparison">
          <h4>Material Cost Comparison (100 ft)</h4>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; font-size: 0.9rem;">
            <div>
              <strong>Copper Type L</strong><br>
              Material: <span id="copperCost">$0</span><br>
              Labor: <span id="copperLabor">$0</span><br>
              <strong>Total: <span id="copperTotal">$0</span></strong>
            </div>
            <div>
              <strong>PEX</strong><br>
              Material: <span id="pexCost">$0</span><br>
              Labor: <span id="pexLabor">$0</span><br>
              <strong>Total: <span id="pexTotal">$0</span></strong>
            </div>
            <div>
              <strong>CPVC</strong><br>
              Material: <span id="cpvcCost">$0</span><br>
              Labor: <span id="cpvcLabor">$0</span><br>
              <strong>Total: <span id="cpvcTotal">$0</span></strong>
            </div>
            <div>
              <strong>Recommended:</strong><br>
              <span id="recommendedMaterial">PEX - Best value</span>
            </div>
          </div>
        </div>

        <div class="drain-section">
          <h4>Water Heater Sizing</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
              <strong>Recommended Tank Size</strong>
              <div id="tankSize">50 gallons</div>
              <div style="color: #718096; font-size: 0.9rem;">Based on bedroom/bathroom count</div>
            </div>
            <div>
              <strong>Recovery Rate</strong>
              <div id="recoveryRate">22 GPH</div>
              <div style="color: #718096; font-size: 0.9rem;">First hour rating needed</div>
            </div>
          </div>
          
          <h5 style="margin-top: 1rem;">Drain System Sizing</h5>
          <div id="drainSizing" style="font-size: 0.9rem;">
            <div>Main drain: <span id="mainDrain">4" PVC</span></div>
            <div>Branch drains: <span id="branchDrains">2" - 3" PVC</span></div>
            <div>Vent stack: <span id="ventStack">3" PVC</span></div>
            <div>Slope requirement: <span id="drainSlope">1/4" per foot minimum</span></div>
          </div>
        </div>

        <h4 style="margin-top: 1.5rem;">Pipe Sizing Schedule</h4>
        <div id="pipingSchedule" style="font-size: 0.9rem;">
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; font-weight: bold;">
            <div>Location</div><div>Size</div><div>Purpose</div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
            <div>Main Supply</div><div id="mainSupplySize">1"</div><div>Service line</div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
            <div>Hot Water Main</div><div id="hotWaterMain">3/4"</div><div>Distribution</div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
            <div>Fixture Branches</div><div id="fixtureBranches">1/2"</div><div>Individual fixtures</div>
          </div>
        </div>

        <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="saveCalculation()" data-action="save">üíæ Save</button>
          <button class="btn btn-secondary" onclick="exportPlumbingPlan()" data-action="export">üìä Export Plan</button>
          <button class="btn btn-secondary" onclick="shareCalculation()">üîó Share</button>
          <button class="btn btn-secondary" onclick="window.print()" data-action="print">üñ®Ô∏è Print</button>
        </div>
      </div>
    </div>

    <div class="disclaimer">
      <strong>‚ö†Ô∏è Important:</strong> This provides rough order of magnitude (ROM) estimates based on standard plumbing codes. All plumbing work must be designed by qualified professionals and comply with local codes. Always consult with a licensed plumber.
    </div>

    <details style="margin-top: 2rem; padding: 1rem; background: #f7fafc; border-radius: 8px;">
      <summary style="cursor: pointer; font-weight: bold;">üìê Calculation Methodology</summary>
      <div style="margin-top: 1rem;">
        <h4>Plumbing Code Calculations:</h4>
        <ul>
          <li><strong>Fixture Units:</strong> Based on IPC Table 403.1 (DFU values per fixture)</li>
          <li><strong>Pipe Sizing:</strong> Per IPC Table 403.4 (DFU to pipe size conversion)</li>
          <li><strong>Pressure Loss:</strong> Hazen-Williams equation for friction loss</li>
          <li><strong>Water Heater:</strong> Based on bedrooms + 1.5 bathrooms method</li>
          <li><strong>Drain Slope:</strong> Minimum 1/4" per foot for 4" and smaller pipes</li>
        </ul>
      </div>
    </details>
  </div>

  <script src="/assets/js/calculator-core.js" defer></script>
  <script src="/assets/js/calculators.js" defer></script>
  <script src="/assets/js/export-utilities.js" defer></script>
  <script src="/assets/js/calculators-hub.js" defer></script>
  <script>
    const calc = new ProCalculator('plumbing-system');
    
    // Plumbing design data
    const plumbingData = {
      // Fixture Unit values (DFU) from IPC Table 403.1
      fixtureUnits: {
        toilet: 6, lavatory: 1, kitchenSink: 2, laundryTub: 2,
        bathtub: 4, shower: 2, dishwasher: 2, washer: 3
      },
      // Pipe sizing based on fixture units (DFU to pipe diameter)
      pipeSizing: {
        8: '1/2"', 16: '3/4"', 32: '1"', 60: '1.25"', 
        100: '1.5"', 160: '2"', 300: '2.5"', 500: '3"'
      },
      // Material costs per linear foot (material + labor)
      materialCosts: {
        copper: {material: 8.50, labor: 12.00},
        pex: {material: 2.25, labor: 8.00},
        cpvc: {material: 3.50, labor: 10.00},
        galvanized: {material: 6.00, labor: 15.00}
      },
      // Friction loss factors (PSI per 100 ft per GPM)
      frictionFactors: {
        copper: {0.5: 0.8, 0.75: 0.3, 1.0: 0.15, 1.25: 0.08, 1.5: 0.05, 2.0: 0.02},
        pex: {0.5: 1.2, 0.75: 0.45, 1.0: 0.22, 1.25: 0.12, 1.5: 0.07, 2.0: 0.03},
        cpvc: {0.5: 1.0, 0.75: 0.38, 1.0: 0.18, 1.25: 0.10, 1.5: 0.06, 2.0: 0.025}
      },
      // Water heater sizing guide (gallons by bedroom count)
      waterHeaterSizing: {
        1: 30, 2: 40, 3: 50, 4: 50, 5: 80, 6: 80, 7: 120, 8: 120
      },
      // Recovery rates by fuel type (gallons per hour)
      recoveryRates: {
        electric: 18, gas: 40, propane: 38, solar: 25
      }
    };

    function calculate() {
      // Get all inputs
      const systemType = document.getElementById('systemType').value;
      const supplyPressure = parseFloat(document.getElementById('supplyPressure').value) || 60;
      const toilets = parseFloat(document.getElementById('toilets').value) || 0;
      const lavatories = parseFloat(document.getElementById('lavatories').value) || 0;
      const kitchenSinks = parseFloat(document.getElementById('kitchenSinks').value) || 0;
      const laundryTubs = parseFloat(document.getElementById('laundryTubs').value) || 0;
      const bathtubs = parseFloat(document.getElementById('bathtubs').value) || 0;
      const showers = parseFloat(document.getElementById('showers').value) || 0;
      const dishwashers = parseFloat(document.getElementById('dishwashers').value) || 0;
      const washers = parseFloat(document.getElementById('washers').value) || 0;
      const mainLineLength = parseFloat(document.getElementById('mainLineLength').value) || 100;
      const branchLength = parseFloat(document.getElementById('branchLength').value) || 25;
      const pipeMaterial = document.getElementById('pipeMaterial').value;
      const floors = parseFloat(document.getElementById('floors').value) || 1;
      const staticHead = parseFloat(document.getElementById('staticHead').value) || 0;
      const bedrooms = parseFloat(document.getElementById('bedrooms').value) || 3;
      const bathrooms = parseFloat(document.getElementById('bathrooms').value) || 2;
      const fuelType = document.getElementById('fuelType').value;

      // Calculate fixture units
      const toiletDFU = toilets * plumbingData.fixtureUnits.toilet;
      const lavDFU = lavatories * plumbingData.fixtureUnits.lavatory;
      const kitchenDFU = kitchenSinks * plumbingData.fixtureUnits.kitchenSink;
      const tubDFU = bathtubs * plumbingData.fixtureUnits.bathtub;
      const showerDFU = showers * plumbingData.fixtureUnits.shower;
      const laundryDFU = laundryTubs * plumbingData.fixtureUnits.laundryTub;
      const dishwasherDFU = dishwashers * plumbingData.fixtureUnits.dishwasher;
      const washerDFU = washers * plumbingData.fixtureUnits.washer;

      const totalDFU = toiletDFU + lavDFU + kitchenDFU + tubDFU + 
                      showerDFU + laundryDFU + dishwasherDFU + washerDFU;

      // Determine pipe sizes
      const mainPipeSize = getPipeSize(totalDFU);
      const estimatedFlowRate = Math.sqrt(totalDFU) * 2.5; // Approximate GPM

      // Pressure loss calculations
      const staticLoss = staticHead * 0.433; // PSI per foot of head
      const frictionLoss = calculateFrictionLoss(estimatedFlowRate, mainLineLength, pipeMaterial);
      const availablePressure = supplyPressure - staticLoss - frictionLoss;

      // Water heater sizing
      const recommendedTankSize = plumbingData.waterHeaterSizing[bedrooms] || 50;
      const recoveryRate = plumbingData.recoveryRates[fuelType];

      // Material cost comparison (for 100 ft)
      const materials = ['copper', 'pex', 'cpvc'];
      const materialComparison = materials.map(material => {
        const costs = plumbingData.materialCosts[material];
        const materialCost = costs.material * 100;
        const laborCost = costs.labor * 100;
        const totalCost = materialCost + laborCost;
        return {material, materialCost, laborCost, totalCost};
      });

      // Find most economical option
      const cheapest = materialComparison.reduce((prev, current) => 
        prev.totalCost < current.totalCost ? prev : current);

      // Update display
      document.getElementById('totalFixtureUnits').textContent = totalDFU + ' DFU';
      document.getElementById('simultaneousLoad').textContent = estimatedFlowRate.toFixed(1) + ' GPM peak demand';
      document.getElementById('mainPipeSize').textContent = mainPipeSize + ' ' + pipeMaterial;
      document.getElementById('flowRate').textContent = estimatedFlowRate.toFixed(1) + ' GPM flow capacity';

      // Fixture unit breakdown
      document.getElementById('toiletDFU').textContent = toiletDFU + ' DFU';
      document.getElementById('lavDFU').textContent = lavDFU + ' DFU';
      document.getElementById('kitchenDFU').textContent = kitchenDFU + ' DFU';
      document.getElementById('tubDFU').textContent = tubDFU + ' DFU';
      document.getElementById('showerDFU').textContent = showerDFU + ' DFU';
      document.getElementById('laundryDFU').textContent = laundryDFU + ' DFU';
      document.getElementById('dishwasherDFU').textContent = dishwasherDFU + ' DFU';
      document.getElementById('washerDFU').textContent = washerDFU + ' DFU';

      // Pressure analysis
      document.getElementById('staticLoss').textContent = staticLoss.toFixed(1) + ' PSI';
      document.getElementById('frictionLoss').textContent = frictionLoss.toFixed(1) + ' PSI';
      document.getElementById('availablePressure').textContent = availablePressure.toFixed(1) + ' PSI';

      // Material comparison
      const copper = materialComparison.find(m => m.material === 'copper');
      const pex = materialComparison.find(m => m.material === 'pex');
      const cpvc = materialComparison.find(m => m.material === 'cpvc');

      document.getElementById('copperCost').textContent = '$' + copper.materialCost.toFixed(0);
      document.getElementById('copperLabor').textContent = '$' + copper.laborCost.toFixed(0);
      document.getElementById('copperTotal').textContent = '$' + copper.totalCost.toFixed(0);
      
      document.getElementById('pexCost').textContent = '$' + pex.materialCost.toFixed(0);
      document.getElementById('pexLabor').textContent = '$' + pex.laborCost.toFixed(0);
      document.getElementById('pexTotal').textContent = '$' + pex.totalCost.toFixed(0);
      
      document.getElementById('cpvcCost').textContent = '$' + cpvc.materialCost.toFixed(0);
      document.getElementById('cpvcLabor').textContent = '$' + cpvc.laborCost.toFixed(0);
      document.getElementById('cpvcTotal').textContent = '$' + cpvc.totalCost.toFixed(0);

      document.getElementById('recommendedMaterial').textContent = 
        cheapest.material.toUpperCase() + ' - Best value ($' + cheapest.totalCost.toFixed(0) + '/100ft)';

      // Water heater and drain sizing
      document.getElementById('tankSize').textContent = recommendedTankSize + ' gallons';
      document.getElementById('recoveryRate').textContent = recoveryRate + ' GPH';
      
      // Pipe sizing schedule
      document.getElementById('mainSupplySize').textContent = mainPipeSize;
      document.getElementById('hotWaterMain').textContent = totalDFU > 32 ? '1"' : '3/4"';
      document.getElementById('fixtureBranches').textContent = '1/2"';

      // Drain system
      const mainDrainSize = totalDFU > 100 ? '4"' : totalDFU > 60 ? '3"' : '2"';
      document.getElementById('mainDrain').textContent = mainDrainSize + ' PVC';
      document.getElementById('branchDrains').textContent = '2" - 3" PVC';
      document.getElementById('ventStack').textContent = mainDrainSize + ' PVC';

      // Save to calculator object
      calc.inputs = { 
        systemType, supplyPressure, toilets, lavatories, kitchenSinks, laundryTubs,
        bathtubs, showers, dishwashers, washers, mainLineLength, branchLength,
        pipeMaterial, floors, staticHead, bedrooms, bathrooms, fuelType
      };
      calc.results = { 
        totalDFU, mainPipeSize, availablePressure: availablePressure.toFixed(1),
        tankSize: recommendedTankSize, bestMaterial: cheapest.material
      };
    }

    function getPipeSize(dfu) {
      for (const [maxDfu, size] of Object.entries(plumbingData.pipeSizing)) {
        if (dfu <= parseInt(maxDfu)) {
          return size;
        }
      }
      return '4"'; // Largest standard size
    }

    function calculateFrictionLoss(gpm, length, material) {
      // Simplified friction loss calculation
      const baseLoss = gpm * gpm * 0.002; // Base friction factor
      const materialMultiplier = material === 'galvanized' ? 2.0 : 
                                material === 'cpvc' ? 1.2 :
                                material === 'copper' ? 1.0 : 0.8; // PEX
      return baseLoss * (length / 100) * materialMultiplier;
    }

    function loadDefaults(type) {
      if (type === 'residential') {
        document.getElementById('systemType').value = 'residential';
        document.getElementById('toilets').value = '3';
        document.getElementById('lavatories').value = '3';
        document.getElementById('bedrooms').value = '3';
        document.getElementById('bathrooms').value = '2';
      } else {
        document.getElementById('systemType').value = 'commercial';
        document.getElementById('toilets').value = '8';
        document.getElementById('lavatories').value = '6';
        document.getElementById('bedrooms').value = '0';
        document.getElementById('bathrooms').value = '4';
      }
      calculate();
    }

    function loadLastUsed() {
      if (calc.loadLastUsed()) {
        Object.keys(calc.inputs).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = calc.inputs[key];
        });
        calculate();
      }
    }

    function saveCalculation() {
      calc.saveCalculation();
    }

    function exportPlumbingPlan() {
      calc.exportCSV();
    }

    function shareCalculation() {
      calc.shareLink();
    }

    // Auto-calculate when inputs change
    document.addEventListener('input', calculate);
    document.addEventListener('change', calculate);

    // Load from URL if shared
    window.onload = function() {
      if (calc.loadFromURL()) {
        Object.keys(calc.inputs).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = calc.inputs[key];
        });
      }
      calculate();
    };
  </script>
<script defer>
    document.getElementById('btn-print')?.addEventListener('click', () => window.print());
</script>
</body>
</html>