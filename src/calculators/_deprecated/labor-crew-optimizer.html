<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self';">
    <title>Labor Crew Optimizer - Multi-Trade Construction Calculator | CostFlowAI</title>
    <meta name="description" content="Optimize construction crew size and composition across trades. Calculate productivity rates, labor costs, and crew efficiency for construction projects.">
    <link rel="canonical" href="https://costflowai.com/calculators/labor-crew-optimizer">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print">
    <style>
        .calculator-container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .calc-section { background: white; border: 1px solid #e5e5e5; border-radius: 12px; padding: 2rem; margin: 1.5rem 0; }
        .calc-section h3 { color: #0369a1; margin-bottom: 1rem; border-bottom: 2px solid #e5e5e5; padding-bottom: 0.5rem; }
        .form-row { display: flex; gap: 1rem; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 200px; margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; }
        .trade-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .trade-card { border: 2px solid #e5e5e5; border-radius: 8px; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.3s; }
        .trade-card.selected { border-color: #0369a1; background: #e0f2fe; }
        .trade-card h4 { margin: 0.5rem 0; color: #374151; }
        .trade-card p { margin: 0; font-size: 0.9rem; color: #6b7280; }
        .crew-composition { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .crew-card { border: 1px solid #e5e5e5; border-radius: 8px; padding: 1.5rem; background: #f8fafc; }
        .crew-card h4 { color: #0369a1; margin-bottom: 1rem; }
        .worker-row { display: flex; justify-content: space-between; align-items: center; margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 4px; }
        .calc-button { background: #0369a1; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin: 1rem 0; }
        .calc-button:hover { background: #0c4a6e; }
        .results-panel { background: linear-gradient(135deg, #e0f2fe, #f0f9ff); border: 2px solid #0369a1; border-radius: 12px; padding: 2rem; margin: 2rem 0; }
        .result-section { margin-bottom: 1.5rem; }
        .result-section h4 { color: #0369a1; margin-bottom: 0.75rem; }
        .optimization-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .optimization-card { background: white; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid #b3d9ff; }
        .optimization-value { font-size: 1.8rem; font-weight: bold; color: #0369a1; margin-bottom: 0.5rem; }
        .optimization-label { font-size: 0.9rem; color: #6b7280; }
        .efficiency-bar { width: 100%; height: 20px; background: #e5e5e5; border-radius: 10px; margin: 0.5rem 0; overflow: hidden; }
        .efficiency-fill { height: 100%; background: linear-gradient(to right, #ef4444, #f59e0b, #10b981); border-radius: 10px; transition: width 0.5s; }
        .warning-banner { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 1rem; margin: 1rem 0; }
        .warning-banner h4 { color: #92400e; margin-bottom: 0.5rem; }
        .warning-banner p { color: #92400e; margin: 0; }
        .tab-container { border-bottom: 2px solid #e5e5e5; margin-bottom: 2rem; }
        .tab-buttons { display: flex; gap: 0; }
        .tab-btn { padding: 1rem 2rem; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; }
        .tab-btn.active { border-bottom-color: #0369a1; color: #0369a1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .actions { display: flex; gap: 1rem; margin: 2rem 0; flex-wrap: wrap; }
        .action-btn { padding: 0.75rem 1.5rem; border: 1px solid #0369a1; background: white; color: #0369a1; border-radius: 6px; cursor: pointer; }
        .action-btn:hover { background: #0369a1; color: white; }
    </style>
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">
</head>
<body>
    <a href="#main-content" class="sr-only skip-nav">Skip to main content</a>
<header>
    <nav class="container">
        <a href="/" class="logo">CostFlowAI</a>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/calculators/">Calculators</a></li>
            <li><a href="/blog/">Blog</a></li>
        </ul>
    </nav>
</header>

<main id="main-content" class="calculator-container">
    <div class="warning-banner">
        <h4>‚ö†Ô∏è ROM Estimate Tool</h4>
        <p><strong>This calculator provides Rough Order of Magnitude (ROM) estimates only.</strong> Actual labor productivity varies significantly based on worker skill, site conditions, weather, and project complexity. Always verify crew requirements and costs with experienced superintendents.</p>
    </div>

    <h1>Labor Crew Optimizer</h1>
    <p>Professional labor crew optimization tool for construction projects. Calculate optimal crew size, composition, and costs across multiple trades while maximizing productivity and minimizing labor expenses.</p>

    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('project')">Project Setup</button>
            <button class="tab-btn" onclick="switchTab('trades')">Trade Selection</button>
            <button class="tab-btn" onclick="switchTab('optimization')">Optimization</button>
            <button class="tab-btn" onclick="switchTab('scheduling')">Scheduling</button>
        </div>
    </div>

    <!-- Project Setup Tab -->
    <div class="tab-content active" id="project-tab">
        <div class="calc-section">
            <h3>Project Information</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="project_type">Project Type</label>
                    <select id="project_type">
                        <option value="residential">Residential Construction</option>
                        <option value="commercial" selected>Commercial Construction</option>
                        <option value="industrial">Industrial Construction</option>
                        <option value="renovation">Renovation/Tenant Improvement</option>
                        <option value="infrastructure">Infrastructure/Civil</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="project_size">Project Size (sq ft)</label>
                    <input type="number" id="project_size" min="100" placeholder="e.g. 25000">
                </div>
                <div class="form-group">
                    <label for="duration">Target Duration (weeks)</label>
                    <input type="number" id="duration" min="1" placeholder="e.g. 24">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="complexity">Project Complexity</label>
                    <select id="complexity">
                        <option value="simple">Simple - Straightforward construction</option>
                        <option value="standard" selected>Standard - Normal complexity</option>
                        <option value="complex">Complex - Multiple systems/details</option>
                        <option value="very_complex">Very Complex - High-end/specialized</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="region">Region</label>
                    <select id="region">
                        <option value="national">National Average</option>
                        <option value="west_coast">West Coast</option>
                        <option value="northeast">Northeast</option>
                        <option value="southeast">Southeast</option>
                        <option value="midwest">Midwest</option>
                        <option value="southwest">Southwest</option>
                        <option value="mountain">Mountain West</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="site_conditions">Site Conditions</label>
                    <select id="site_conditions">
                        <option value="excellent">Excellent - Easy access, ideal conditions</option>
                        <option value="good" selected>Good - Normal site conditions</option>
                        <option value="fair">Fair - Some access/space limitations</option>
                        <option value="poor">Poor - Difficult access/tight spaces</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="work_schedule">Work Schedule</label>
                    <select id="work_schedule">
                        <option value="standard" selected>Standard - 8hr/day, 5 days/week</option>
                        <option value="extended">Extended - 10hr/day, 5 days/week</option>
                        <option value="overtime">Overtime - 8hr + 4hr OT, 5 days/week</option>
                        <option value="accelerated">Accelerated - 10hr/day, 6 days/week</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Selection Tab -->
    <div class="tab-content" id="trades-tab">
        <div class="calc-section">
            <h3>Select Construction Trades</h3>
            <p>Select the trades required for your project. The optimizer will calculate optimal crew sizes for each selected trade.</p>
            
            <div class="trade-selector">
                <div class="trade-card" onclick="toggleTrade('framing')" id="framing-card">
                    <h4>üî® Framing</h4>
                    <p>Rough carpentry, structural framing</p>
                    <p><strong>$32/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('concrete')" id="concrete-card">
                    <h4>üèóÔ∏è Concrete</h4>
                    <p>Concrete placement and finishing</p>
                    <p><strong>$35/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('electrical')" id="electrical-card">
                    <h4>‚ö° Electrical</h4>
                    <p>Electrical rough-in and finish</p>
                    <p><strong>$45/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('plumbing')" id="plumbing-card">
                    <h4>üîß Plumbing</h4>
                    <p>Plumbing rough-in and fixtures</p>
                    <p><strong>$48/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('hvac')" id="hvac-card">
                    <h4>üå°Ô∏è HVAC</h4>
                    <p>Mechanical systems installation</p>
                    <p><strong>$42/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('drywall')" id="drywall-card">
                    <h4>üß± Drywall</h4>
                    <p>Drywall installation and finishing</p>
                    <p><strong>$28/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('roofing')" id="roofing-card">
                    <h4>üè† Roofing</h4>
                    <p>Roofing systems installation</p>
                    <p><strong>$30/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('flooring')" id="flooring-card">
                    <h4>ü™µ Flooring</h4>
                    <p>All flooring installation types</p>
                    <p><strong>$30/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('painting')" id="painting-card">
                    <h4>üé® Painting</h4>
                    <p>Interior and exterior painting</p>
                    <p><strong>$25/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('masonry')" id="masonry-card">
                    <h4>üß± Masonry</h4>
                    <p>Brick, block, and stone work</p>
                    <p><strong>$38/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('insulation')" id="insulation-card">
                    <h4>üè† Insulation</h4>
                    <p>Thermal and acoustic insulation</p>
                    <p><strong>$24/hr avg</strong></p>
                </div>
                <div class="trade-card" onclick="toggleTrade('sitework')" id="sitework-card">
                    <h4>üöú Sitework</h4>
                    <p>Excavation and site preparation</p>
                    <p><strong>$26/hr avg</strong></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Optimization Tab -->
    <div class="tab-content" id="optimization-tab">
        <div class="calc-section">
            <h3>Optimization Parameters</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="optimization_goal">Primary Optimization Goal</label>
                    <select id="optimization_goal">
                        <option value="cost" selected>Minimize Total Labor Cost</option>
                        <option value="time">Minimize Project Duration</option>
                        <option value="efficiency">Maximize Crew Efficiency</option>
                        <option value="balanced">Balanced Cost/Time/Quality</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="crew_experience">Average Crew Experience</label>
                    <select id="crew_experience">
                        <option value="apprentice">Apprentice Level (0-2 years)</option>
                        <option value="journeyman" selected>Journeyman Level (3-7 years)</option>
                        <option value="experienced">Experienced (8+ years)</option>
                        <option value="master">Master Level (15+ years)</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="overtime_allowance">Overtime Allowance</label>
                    <select id="overtime_allowance">
                        <option value="none" selected>No Overtime Allowed</option>
                        <option value="limited">Limited Overtime (2hrs/day max)</option>
                        <option value="moderate">Moderate Overtime (4hrs/day max)</option>
                        <option value="unlimited">Unlimited Overtime</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quality_requirements">Quality Requirements</label>
                    <select id="quality_requirements">
                        <option value="standard" selected>Standard Quality</option>
                        <option value="high">High Quality (slower pace)</option>
                        <option value="premium">Premium Quality (detailed work)</option>
                        <option value="fast_track">Fast Track (speed priority)</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="budget_constraint">Budget Constraint</label>
                    <input type="number" id="budget_constraint" min="0" placeholder="Enter max labor budget (optional)">
                </div>
                <div class="form-group">
                    <label for="crew_continuity">Crew Continuity Priority</label>
                    <select id="crew_continuity">
                        <option value="low">Low - Optimize per phase</option>
                        <option value="medium" selected>Medium - Some continuity</option>
                        <option value="high">High - Same crews throughout</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Scheduling Tab -->
    <div class="tab-content" id="scheduling-tab">
        <div class="calc-section">
            <h3>Schedule Constraints</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="weather_factor">Weather Impact</label>
                    <select id="weather_factor">
                        <option value="minimal">Minimal - Indoor/protected work</option>
                        <option value="moderate" selected>Moderate - Some weather exposure</option>
                        <option value="significant">Significant - Outdoor work</option>
                        <option value="severe">Severe - Weather-sensitive work</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="seasonal_factor">Seasonal Considerations</label>
                    <select id="seasonal_factor">
                        <option value="none">No seasonal impact</option>
                        <option value="winter" selected>Winter conditions</option>
                        <option value="summer">Summer conditions</option>
                        <option value="rainy_season">Rainy season</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="mobilization_time">Crew Mobilization Time</label>
                    <select id="mobilization_time">
                        <option value="immediate">Immediate availability</option>
                        <option value="1week" selected>1 week notice required</option>
                        <option value="2weeks">2 weeks notice required</option>
                        <option value="1month">1 month notice required</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="permit_delays">Permit/Inspection Delays</label>
                    <select id="permit_delays">
                        <option value="none">No permit delays expected</option>
                        <option value="minor" selected>Minor delays (1-2 days)</option>
                        <option value="moderate">Moderate delays (3-5 days)</option>
                        <option value="significant">Significant delays (1-2 weeks)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <button class="calc-button" onclick="calculateCrewOptimization()">Optimize Crew Composition</button>

    <div id="results" class="results-panel" style="display: none;">
        <h2>Optimized Crew Analysis</h2>
        
        <div class="result-section">
            <h4>üéØ Optimization Summary</h4>
            <div class="optimization-grid">
                <div class="optimization-card">
                    <div class="optimization-value" id="total_workers">--</div>
                    <div class="optimization-label">Total Workers</div>
                </div>
                <div class="optimization-card">
                    <div class="optimization-value" id="daily_cost">--</div>
                    <div class="optimization-label">Daily Labor Cost</div>
                </div>
                <div class="optimization-card">
                    <div class="optimization-value" id="project_duration">--</div>
                    <div class="optimization-label">Estimated Duration</div>
                </div>
                <div class="optimization-card">
                    <div class="optimization-value" id="efficiency_score">--</div>
                    <div class="optimization-label">Efficiency Score</div>
                    <div class="efficiency-bar">
                        <div class="efficiency-fill" id="efficiency_bar"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="result-section">
            <h4>üë• Optimized Crew Composition</h4>
            <div class="crew-composition" id="crew_breakdown">
            </div>
        </div>

        <div class="result-section">
            <h4>üí∞ Cost Analysis</h4>
            <div id="cost_analysis"></div>
        </div>

        <div class="result-section">
            <h4>üìÖ Schedule Impact</h4>
            <div id="schedule_analysis"></div>
        </div>

        <div class="result-section">
            <h4>‚ö†Ô∏è Optimization Recommendations</h4>
            <div id="recommendations"></div>
        </div>
    </div>

    <div class="actions">
        <button class="action-btn" onclick="copyResults()">üìã Copy Results</button>
        <button class="action-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
        <button class="action-btn" onclick="exportToCSV()">üìä Export CSV</button>
        <button class="action-btn" onclick="shareResults()">üîó Share Link</button>
        <button class="action-btn" onclick="saveCalculation()">üíæ Save Calculation</button>
    </div>

    <div class="calc-section">
        <h3>üí° Optimization Methodology</h3>
        <p><strong>This calculator optimizes crew composition using:</strong></p>
        <ul>
            <li><strong>Productivity Analysis:</strong> Industry-standard production rates adjusted for project complexity and crew experience</li>
            <li><strong>Resource Leveling:</strong> Balances workforce requirements across project phases to minimize peaks and valleys</li>
            <li><strong>Cost Optimization:</strong> Considers base wages, overtime premiums, and productivity factors to minimize total labor cost</li>
            <li><strong>Schedule Integration:</strong> Aligns crew sizing with critical path activities and sequence constraints</li>
            <li><strong>Efficiency Modeling:</strong> Accounts for crew size efficiency curves (optimal crew sizes for different work types)</li>
            <li><strong>Multi-Trade Coordination:</strong> Optimizes for trade stacking and workspace sharing where applicable</li>
        </ul>
        
        <h4>üìä Key Performance Indicators:</h4>
        <ul>
            <li><strong>Labor Productivity:</strong> Work-hours per unit of production adjusted for conditions</li>
            <li><strong>Crew Efficiency:</strong> Composite score based on crew size, experience, and coordination</li>
            <li><strong>Cost per Unit:</strong> Total labor cost divided by project units (sq ft, rooms, etc.)</li>
            <li><strong>Schedule Performance:</strong> Ability to meet target completion dates with optimized crews</li>
        </ul>

        <h4>üö® Critical Limitations:</h4>
        <ul>
            <li>Assumes standard work conditions - site-specific factors can significantly impact productivity</li>
            <li>Does not include material handling, equipment, or supervision costs beyond crew leaders</li>
            <li>Weather delays and change orders can disrupt optimized schedules</li>
            <li>Local labor availability and union requirements may limit crew composition options</li>
            <li>Productivity rates are industry averages - individual crew performance varies widely</li>
        </ul>
    </div>

    <div class="warning-banner">
        <h4>‚ö†Ô∏è Professional Verification Required</h4>
        <p><strong>Critical:</strong> This ROM optimization tool is for preliminary planning only. Actual crew optimization requires detailed project analysis, local labor market assessment, and input from experienced superintendents. Always verify crew plans with qualified project management professionals before implementation.</p>
    </div>
</main>

<footer>
    <div class="container">
        <div class="trust-signals">
            <p>‚úì 100% Free - No signup required</p>
            <p>‚úì All calculations shown transparently</p>
            <p>‚úì Privacy-first: No data stored</p>
            <p>Email: support@costflowai.com (24hr response)</p>
        </div>
        <div style="padding: 2rem 0; text-align: center; border-top: 1px solid #e5e5e5;">
            <p>&copy; 2025 CostFlowAI. All rights reserved. | 
               <a href="/privacy" style="color: #666;">Privacy Policy</a> | 
               <a href="/terms" style="color: #666;">Terms of Service</a>
            </p>
        </div>
    </div>
</footer>

<script src="/assets/js/advanced-calculators.js" defer></script>
<script>
// Labor Crew Optimizer Implementation
class LaborCrewOptimizer extends AdvancedCalculator {
    constructor() {
        super('Labor_Crew_Optimizer', '1.0');
        this.selectedTrades = new Set();
        this.tradeData = this.getTradeData();
        this.productivityRates = this.getProductivityRates();
        this.loadFromLink();
    }

    getTradeData() {
        return {
            framing: { name: 'Framing', baseRate: 32, productivity: 180, optimalCrewSize: 4 },
            concrete: { name: 'Concrete', baseRate: 35, productivity: 150, optimalCrewSize: 5 },
            electrical: { name: 'Electrical', baseRate: 45, productivity: 120, optimalCrewSize: 3 },
            plumbing: { name: 'Plumbing', baseRate: 48, productivity: 100, optimalCrewSize: 3 },
            hvac: { name: 'HVAC', baseRate: 42, productivity: 110, optimalCrewSize: 3 },
            drywall: { name: 'Drywall', baseRate: 28, productivity: 200, optimalCrewSize: 4 },
            roofing: { name: 'Roofing', baseRate: 30, productivity: 160, optimalCrewSize: 4 },
            flooring: { name: 'Flooring', baseRate: 30, productivity: 140, optimalCrewSize: 3 },
            painting: { name: 'Painting', baseRate: 25, productivity: 220, optimalCrewSize: 3 },
            masonry: { name: 'Masonry', baseRate: 38, productivity: 90, optimalCrewSize: 4 },
            insulation: { name: 'Insulation', baseRate: 24, productivity: 250, optimalCrewSize: 3 },
            sitework: { name: 'Sitework', baseRate: 26, productivity: 200, optimalCrewSize: 5 }
        };
    }

    getProductivityRates() {
        return {
            residential: { multiplier: 1.0, complexity: { simple: 1.15, standard: 1.0, complex: 0.85, very_complex: 0.70 }},
            commercial: { multiplier: 0.90, complexity: { simple: 1.10, standard: 1.0, complex: 0.80, very_complex: 0.65 }},
            industrial: { multiplier: 0.85, complexity: { simple: 1.05, standard: 1.0, complex: 0.75, very_complex: 0.60 }},
            renovation: { multiplier: 0.75, complexity: { simple: 1.00, standard: 0.85, complex: 0.70, very_complex: 0.55 }},
            infrastructure: { multiplier: 0.80, complexity: { simple: 1.00, standard: 0.90, complex: 0.75, very_complex: 0.60 }}
        };
    }

    calculate() {
        try {
            // Get inputs
            this.inputs = {
                project_type: document.getElementById('project_type').value,
                project_size: parseFloat(document.getElementById('project_size').value) || 0,
                duration: parseFloat(document.getElementById('duration').value) || 0,
                complexity: document.getElementById('complexity').value,
                region: document.getElementById('region').value,
                site_conditions: document.getElementById('site_conditions').value,
                work_schedule: document.getElementById('work_schedule').value,
                optimization_goal: document.getElementById('optimization_goal').value,
                crew_experience: document.getElementById('crew_experience').value,
                overtime_allowance: document.getElementById('overtime_allowance').value,
                quality_requirements: document.getElementById('quality_requirements').value,
                budget_constraint: parseFloat(document.getElementById('budget_constraint').value) || 0,
                crew_continuity: document.getElementById('crew_continuity').value,
                weather_factor: document.getElementById('weather_factor').value,
                seasonal_factor: document.getElementById('seasonal_factor').value,
                mobilization_time: document.getElementById('mobilization_time').value,
                permit_delays: document.getElementById('permit_delays').value,
                selectedTrades: Array.from(this.selectedTrades)
            };

            // Validate inputs
            const errors = this.validateInputs(this.inputs);
            if (errors.length > 0) {
                alert('Please correct the following:\n' + errors.join('\n'));
                return;
            }

            // Calculate optimization
            const optimizedCrews = this.optimizeCrews();
            const costAnalysis = this.calculateCostAnalysis(optimizedCrews);
            const scheduleAnalysis = this.calculateScheduleAnalysis(optimizedCrews);
            const recommendations = this.generateRecommendations(optimizedCrews, costAnalysis, scheduleAnalysis);

            this.results = {
                optimizedCrews: optimizedCrews,
                costAnalysis: costAnalysis,
                scheduleAnalysis: scheduleAnalysis,
                recommendations: recommendations,
                totalWorkers: optimizedCrews.reduce((sum, crew) => sum + crew.totalWorkers, 0),
                dailyCost: costAnalysis.dailyLaborCost,
                efficiencyScore: this.calculateEfficiencyScore(optimizedCrews)
            };

            this.displayResults();
            
        } catch (error) {
            alert('Calculation error: ' + error.message);
        }
    }

    optimizeCrews() {
        const crews = [];
        const { project_type, project_size, complexity, site_conditions, crew_experience, optimization_goal } = this.inputs;
        
        // Get base productivity multipliers
        const projectMultiplier = this.productivityRates[project_type].multiplier;
        const complexityMultiplier = this.productivityRates[project_type].complexity[complexity];
        
        // Site condition adjustments
        const siteMultipliers = { excellent: 1.15, good: 1.0, fair: 0.90, poor: 0.75 };
        const siteMultiplier = siteMultipliers[site_conditions];
        
        // Experience level adjustments
        const experienceMultipliers = { apprentice: 0.75, journeyman: 1.0, experienced: 1.20, master: 1.35 };
        const experienceMultiplier = experienceMultipliers[crew_experience];
        
        // Regional cost adjustments
        const regionalFactor = AdvancedCalculator.getRegionalFactors()[this.inputs.region]?.labor || 1.0;

        for (const tradeId of this.inputs.selectedTrades) {
            const trade = this.tradeData[tradeId];
            if (!trade) continue;

            // Calculate optimal crew size based on project size and optimization goal
            let crewSize = trade.optimalCrewSize;
            const workIntensity = project_size / 10000; // Rough measure of work intensity

            // Adjust crew size based on optimization goal
            if (optimization_goal === 'time') {
                crewSize = Math.ceil(crewSize * Math.min(1.5, 1 + workIntensity * 0.5));
            } else if (optimization_goal === 'cost') {
                crewSize = Math.max(2, Math.floor(crewSize * 0.85));
            }

            // Calculate productivity
            const baseProductivity = trade.productivity * projectMultiplier * complexityMultiplier * siteMultiplier * experienceMultiplier;
            
            // Crew size efficiency curve (diminishing returns for larger crews)
            const efficiencyCurve = this.calculateCrewEfficiency(crewSize, trade.optimalCrewSize);
            const adjustedProductivity = baseProductivity * efficiencyCurve;

            // Calculate crew composition
            const crew = {
                trade: trade.name,
                tradeId: tradeId,
                totalWorkers: crewSize,
                composition: this.calculateCrewComposition(crewSize, trade),
                hourlyRate: trade.baseRate * regionalFactor,
                productivity: adjustedProductivity,
                efficiency: efficiencyCurve * 100,
                dailyCost: this.calculateDailyCost(crewSize, trade.baseRate * regionalFactor),
                workHours: this.calculateWorkHours(project_size, adjustedProductivity)
            };

            crews.push(crew);
        }

        return crews;
    }

    calculateCrewEfficiency(actualSize, optimalSize) {
        // Efficiency curve: optimal at recommended size, decreases for too small or too large
        const ratio = actualSize / optimalSize;
        if (ratio <= 1) {
            return 0.7 + 0.3 * ratio; // Efficiency increases from 70% to 100% as we approach optimal
        } else {
            return 1 - (ratio - 1) * 0.15; // Efficiency decreases by 15% for each person over optimal
        }
    }

    calculateCrewComposition(totalWorkers, trade) {
        // Default crew composition ratios
        const compositions = {
            framing: { foreman: 0.25, journeyman: 0.50, laborer: 0.25 },
            concrete: { foreman: 0.20, finisher: 0.40, laborer: 0.40 },
            electrical: { foreman: 0.33, journeyman: 0.34, apprentice: 0.33 },
            plumbing: { foreman: 0.33, journeyman: 0.34, apprentice: 0.33 },
            hvac: { foreman: 0.33, technician: 0.34, helper: 0.33 },
            drywall: { foreman: 0.25, hanger: 0.50, finisher: 0.25 },
            roofing: { foreman: 0.25, roofer: 0.50, laborer: 0.25 },
            flooring: { foreman: 0.33, installer: 0.34, helper: 0.33 },
            painting: { foreman: 0.33, painter: 0.34, helper: 0.33 },
            masonry: { foreman: 0.25, mason: 0.50, tender: 0.25 },
            insulation: { foreman: 0.33, installer: 0.34, helper: 0.33 },
            sitework: { foreman: 0.20, operator: 0.40, laborer: 0.40 }
        };

        const composition = compositions[trade.name.toLowerCase().replace(' ', '')] || { foreman: 0.33, worker: 0.34, helper: 0.33 };
        const result = {};
        
        for (const [role, ratio] of Object.entries(composition)) {
            result[role] = Math.max(1, Math.round(totalWorkers * ratio));
        }

        // Adjust to match total workers
        const calculatedTotal = Object.values(result).reduce((sum, count) => sum + count, 0);
        if (calculatedTotal !== totalWorkers) {
            const diff = totalWorkers - calculatedTotal;
            const primaryRole = Object.keys(result)[1] || Object.keys(result)[0];
            result[primaryRole] += diff;
        }

        return result;
    }

    calculateDailyCost(crewSize, hourlyRate) {
        const { work_schedule, overtime_allowance } = this.inputs;
        
        let dailyHours = 8;
        let overtimeHours = 0;
        
        if (work_schedule === 'extended') dailyHours = 10;
        else if (work_schedule === 'overtime') { dailyHours = 8; overtimeHours = 4; }
        else if (work_schedule === 'accelerated') dailyHours = 10;

        if (overtime_allowance === 'limited') overtimeHours = Math.min(overtimeHours, 2);
        else if (overtime_allowance === 'moderate') overtimeHours = Math.min(overtimeHours, 4);

        const regularCost = crewSize * hourlyRate * dailyHours;
        const overtimeCost = crewSize * hourlyRate * 1.5 * overtimeHours;
        
        return regularCost + overtimeCost;
    }

    calculateWorkHours(projectSize, productivity) {
        // Simplified work hours calculation based on productivity rate (sq ft per hour)
        return Math.ceil(projectSize / productivity);
    }

    calculateCostAnalysis(crews) {
        const dailyLaborCost = crews.reduce((sum, crew) => sum + crew.dailyCost, 0);
        const totalWorkDays = Math.max(...crews.map(crew => Math.ceil(crew.workHours / 8)));
        const totalLaborCost = dailyLaborCost * totalWorkDays;
        
        const breakdown = crews.map(crew => ({
            trade: crew.trade,
            dailyCost: crew.dailyCost,
            totalDays: Math.ceil(crew.workHours / 8),
            totalCost: crew.dailyCost * Math.ceil(crew.workHours / 8),
            costPerSqFt: (crew.dailyCost * Math.ceil(crew.workHours / 8)) / this.inputs.project_size
        }));

        return {
            dailyLaborCost: dailyLaborCost,
            totalLaborCost: totalLaborCost,
            totalWorkDays: totalWorkDays,
            costPerSqFt: totalLaborCost / this.inputs.project_size,
            breakdown: breakdown
        };
    }

    calculateScheduleAnalysis(crews) {
        const maxDuration = Math.max(...crews.map(crew => Math.ceil(crew.workHours / 8 / 5))); // Convert to weeks
        const targetDuration = this.inputs.duration;
        const scheduleVariance = ((maxDuration - targetDuration) / targetDuration * 100).toFixed(1);
        
        // Critical path analysis (simplified)
        const criticalTrades = crews.filter(crew => Math.ceil(crew.workHours / 8 / 5) >= maxDuration * 0.9);

        return {
            calculatedDuration: maxDuration,
            targetDuration: targetDuration,
            scheduleVariance: parseFloat(scheduleVariance),
            onSchedule: maxDuration <= targetDuration,
            criticalTrades: criticalTrades.map(crew => crew.trade)
        };
    }

    calculateEfficiencyScore(crews) {
        // Composite efficiency score (0-100)
        const avgEfficiency = crews.reduce((sum, crew) => sum + crew.efficiency, 0) / crews.length;
        const sizeOptimality = crews.reduce((sum, crew) => {
            const optimal = this.tradeData[crew.tradeId].optimalCrewSize;
            return sum + (1 - Math.abs(crew.totalWorkers - optimal) / optimal);
        }, 0) / crews.length;
        
        return Math.round(avgEfficiency * 0.7 + sizeOptimality * 100 * 0.3);
    }

    generateRecommendations(crews, costAnalysis, scheduleAnalysis) {
        const recommendations = [];
        
        // Schedule recommendations
        if (scheduleAnalysis.scheduleVariance > 10) {
            recommendations.push(`‚è∞ Project is ${scheduleAnalysis.scheduleVariance}% over target duration. Consider increasing crew sizes for critical trades: ${scheduleAnalysis.criticalTrades.join(', ')}`);
        } else if (scheduleAnalysis.scheduleVariance < -10) {
            recommendations.push(`üìÖ Project is ahead of schedule by ${Math.abs(scheduleAnalysis.scheduleVariance)}%. Consider reducing crew sizes to optimize costs.`);
        }

        // Cost optimization recommendations
        if (costAnalysis.costPerSqFt > 15) {
            recommendations.push('üí∞ Labor cost per sq ft is high. Review crew sizes and consider value engineering.');
        }

        // Efficiency recommendations
        const lowEfficiencyCrews = crews.filter(crew => crew.efficiency < 80);
        if (lowEfficiencyCrews.length > 0) {
            recommendations.push(`‚ö° Low efficiency detected in: ${lowEfficiencyCrews.map(c => c.trade).join(', ')}. Consider adjusting crew sizes closer to optimal.`);
        }

        // Trade coordination recommendations
        if (crews.length > 6) {
            recommendations.push('üë• Large number of trades selected. Consider trade stacking and coordination meetings to prevent conflicts.');
        }

        // Budget constraint recommendations
        if (this.inputs.budget_constraint > 0 && costAnalysis.totalLaborCost > this.inputs.budget_constraint) {
            const overage = ((costAnalysis.totalLaborCost - this.inputs.budget_constraint) / this.inputs.budget_constraint * 100).toFixed(1);
            recommendations.push(`üö® Labor cost exceeds budget by ${overage}%. Consider reducing crew sizes or extending schedule.`);
        }

        return recommendations;
    }

    displayResults() {
        document.getElementById('results').style.display = 'block';
        
        // Summary values
        document.getElementById('total_workers').textContent = this.results.totalWorkers;
        document.getElementById('daily_cost').textContent = this.formatCurrency(this.results.dailyCost);
        document.getElementById('project_duration').textContent = this.results.scheduleAnalysis.calculatedDuration + ' weeks';
        document.getElementById('efficiency_score').textContent = this.results.efficiencyScore + '%';
        
        // Efficiency bar
        const efficiencyBar = document.getElementById('efficiency_bar');
        efficiencyBar.style.width = this.results.efficiencyScore + '%';

        // Crew breakdown
        const crewContainer = document.getElementById('crew_breakdown');
        crewContainer.innerHTML = this.results.optimizedCrews.map(crew => `
            <div class="crew-card">
                <h4>${crew.trade} Crew (${crew.totalWorkers} workers)</h4>
                ${Object.entries(crew.composition).map(([role, count]) => `
                    <div class="worker-row">
                        <span>${this.formatLabel(role)}: ${count}</span>
                        <span>$${crew.hourlyRate}/hr</span>
                    </div>
                `).join('')}
                <div style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #e5e5e5;">
                    <strong>Daily Cost: ${this.formatCurrency(crew.dailyCost)}</strong><br>
                    <small>Efficiency: ${crew.efficiency.toFixed(1)}% | Productivity: ${crew.productivity.toFixed(0)} sq ft/day</small>
                </div>
            </div>
        `).join('');

        // Cost analysis
        document.getElementById('cost_analysis').innerHTML = `
            <p><strong>Total Labor Cost:</strong> ${this.formatCurrency(this.results.costAnalysis.totalLaborCost)}</p>
            <p><strong>Daily Labor Cost:</strong> ${this.formatCurrency(this.results.costAnalysis.dailyLaborCost)}</p>
            <p><strong>Cost per Sq Ft:</strong> ${this.formatCurrency(this.results.costAnalysis.costPerSqFt)}</p>
            <p><strong>Total Work Days:</strong> ${this.results.costAnalysis.totalWorkDays} days</p>
            
            <h5>Cost Breakdown by Trade:</h5>
            <ul>
                ${this.results.costAnalysis.breakdown.map(item => 
                    `<li><strong>${item.trade}:</strong> ${this.formatCurrency(item.totalCost)} (${item.totalDays} days @ ${this.formatCurrency(item.dailyCost)}/day)</li>`
                ).join('')}
            </ul>
        `;

        // Schedule analysis
        const scheduleClass = this.results.scheduleAnalysis.onSchedule ? 'text-success' : 'text-warning';
        document.getElementById('schedule_analysis').innerHTML = `
            <p><strong>Calculated Duration:</strong> <span class="${scheduleClass}">${this.results.scheduleAnalysis.calculatedDuration} weeks</span></p>
            <p><strong>Target Duration:</strong> ${this.results.scheduleAnalysis.targetDuration} weeks</p>
            <p><strong>Schedule Variance:</strong> ${this.results.scheduleAnalysis.scheduleVariance}%</p>
            <p><strong>Status:</strong> ${this.results.scheduleAnalysis.onSchedule ? '‚úÖ On Schedule' : '‚ö†Ô∏è Over Schedule'}</p>
            ${this.results.scheduleAnalysis.criticalTrades.length > 0 ? 
                `<p><strong>Critical Trades:</strong> ${this.results.scheduleAnalysis.criticalTrades.join(', ')}</p>` : 
                ''
            }
        `;

        // Recommendations
        document.getElementById('recommendations').innerHTML = this.results.recommendations.length > 0 ?
            `<ul>${this.results.recommendations.map(rec => `<li>${rec}</li>`).join('')}</ul>` :
            '<p>‚úÖ Crew optimization looks good! No major recommendations at this time.</p>';

        // Scroll to results
        document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }

    validateInputs(inputs) {
        const errors = [];
        if (!inputs.project_size || inputs.project_size <= 0) errors.push('Project size must be greater than 0');
        if (!inputs.duration || inputs.duration <= 0) errors.push('Duration must be greater than 0');
        if (inputs.selectedTrades.length === 0) errors.push('Please select at least one trade');
        if (inputs.project_size > 1000000) errors.push('Projects over 1M sq ft require custom analysis');
        return errors;
    }
}

// Trade selection functionality
function toggleTrade(tradeId) {
    const card = document.getElementById(tradeId + '-card');
    const optimizer = window.laborOptimizer;
    
    if (optimizer.selectedTrades.has(tradeId)) {
        optimizer.selectedTrades.delete(tradeId);
        card.classList.remove('selected');
    } else {
        optimizer.selectedTrades.add(tradeId);
        card.classList.add('selected');
    }
}

// Tab switching functionality
function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
}

// Initialize calculator
let laborOptimizer;
document.addEventListener('DOMContentLoaded', function() {
    laborOptimizer = new LaborCrewOptimizer();
    window.laborOptimizer = laborOptimizer;
});

// Calculate function
function calculateCrewOptimization() {
    laborOptimizer.calculate();
}

// Action button functions
function copyResults() {
    if (!laborOptimizer.results) {
        alert('Calculate first to copy results');
        return;
    }
    
    const resultsText = `
Labor Crew Optimization Results
Generated: ${new Date().toLocaleString()}

OPTIMIZATION SUMMARY:
- Total Workers: ${laborOptimizer.results.totalWorkers}
- Daily Labor Cost: ${laborOptimizer.formatCurrency(laborOptimizer.results.dailyCost)}
- Project Duration: ${laborOptimizer.results.scheduleAnalysis.calculatedDuration} weeks
- Efficiency Score: ${laborOptimizer.results.efficiencyScore}%

CREW COMPOSITION:
${laborOptimizer.results.optimizedCrews.map(crew => 
    `${crew.trade}: ${crew.totalWorkers} workers - ${laborOptimizer.formatCurrency(crew.dailyCost)}/day`
).join('\n')}

TOTAL PROJECT COST: ${laborOptimizer.formatCurrency(laborOptimizer.results.costAnalysis.totalLaborCost)}

ROM DISCLAIMER: These are rough estimates only. Verify with project managers.
    `;
    
    navigator.clipboard.writeText(resultsText).then(() => {
        laborOptimizer.showNotification('Results copied to clipboard!', 'success');
    });
}

function exportToPDF() { laborOptimizer.generatePDF(); }
function exportToCSV() { laborOptimizer.exportToCSV(); }
function shareResults() { laborOptimizer.shareableLink(); }
function saveCalculation() {
    const notes = prompt('Add notes for this calculation (optional):') || '';
    laborOptimizer.saveCalculation(notes);
}
</script>

<script defer>
    document.getElementById('btn-print')?.addEventListener('click', () => window.print());
</script>
<script src="/assets/js/ga-init.js" defer></script>
</body>
</html>