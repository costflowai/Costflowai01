<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concrete Calculator - CostFlowAI</title>
    <meta name="description" content="Calculate concrete volume, cost, materials for construction projects. Free professional calculator.">
    <link rel="canonical" href="https://costflowai.com/calculators/concrete">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com; font-src 'self';">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Concrete Calculator - CostFlowAI",
      "url": "https://costflowai.com/calculators/concrete",
      "operatingSystem": "Web",
      "applicationCategory": "BusinessApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization", 
        "name": "CostFlowAI",
        "url": "https://costflowai.com"
      },
      "description": "Calculate concrete volume, cost, materials for construction projects. Free professional calculator."
    }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f7fafc; color: #2d3748; }
        .container { max-width: 1000px; margin: 0 auto; padding: 1rem; }
        .nav { margin: 1rem 0; }
        .nav a { color: #ff6b35; text-decoration: none; margin-right: 1rem; }
        .nav a:hover { text-decoration: underline; }
        .header { background: linear-gradient(135deg, #1e3a5f, #0f1f33); color: white; padding: 2rem; text-align: center; border-radius: 8px 8px 0 0; }
        .calc-wrapper { background: white; border-radius: 0 0 8px 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 2rem; }
        .input-section { background: #f7fafc; padding: 1.5rem; border-radius: 8px; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 0.25rem; color: #1e3a5f; }
        .input-group input, .input-group select { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 1rem; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #ff6b35; box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1); }
        .input-group input.error { border-color: #e53e3e; }
        .field-errors { color: #e53e3e; font-size: 0.875rem; margin-top: 0.25rem; }
        .btn { background: #ff6b35; color: white; border: none; padding: 1rem 2rem; border-radius: 4px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 1rem; transition: background 0.2s; }
        .btn:hover { background: #e55a2b; }
        .btn:disabled { background: #cbd5e0; cursor: not-allowed; }
        .results { background: #f0f9ff; padding: 1.5rem; border-radius: 8px; }
        .result-main { font-size: 2rem; font-weight: 700; color: #ff6b35; margin: 1rem 0; }
        .result-row { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0; }
        .actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .btn-secondary { background: #e2e8f0; color: #2d3748; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
        .disclaimer { background: #fff5f5; border-left: 4px solid #ff6b35; padding: 1rem; margin: 2rem; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 1rem; border-radius: 4px; z-index: 9999; max-width: 400px; }
        .notification-success { background: #38a169; color: white; }
        .notification-error { background: #e53e3e; color: white; }
        .notification-info { background: #3182ce; color: white; }
        @media (max-width: 768px) { 
            .calc-grid { grid-template-columns: 1fr; }
            .container { padding: 0.5rem; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="sr-only skip-nav">Skip to main content</a>
    <div class="container">
        <nav class="nav" role="navigation" aria-label="Main navigation">
            <a href="/">Home</a>
            <a href="/calculators/">Calculators</a>
            <a href="/blog/">Blog</a>
            <a href="/#contact">Contact</a>
            <a href="/#contact">üí¨ Feedback</a>
        </nav>
        
        <header class="header">
            <h1>üèóÔ∏è Concrete Calculator</h1>
            <p>Professional concrete volume and cost estimation</p>
        </header>
        
        <div class="calc-wrapper" id="concrete-calc" data-calc="concrete">
            <form id="concreteCalculator" class="calc-grid" novalidate>
                <div class="input-section">
                    <h2>Project Details</h2>
                    
                    <div class="input-group">
                        <label for="pourType">Pour Type</label>
                        <select id="pourType" name="pourType" data-validate="required" aria-describedby="pourType-help">
                            <option value="">Select pour type</option>
                            <option value="slab">Slab on Grade (5% waste)</option>
                            <option value="footing">Footing (8% waste)</option>
                            <option value="wall">Wall (10% waste)</option>
                            <option value="driveway">Driveway (7% waste)</option>
                        </select>
                        <div id="pourType-help" class="sr-only">Choose the type of concrete pour to calculate appropriate waste factors</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="length">Length (feet)</label>
                        <input type="number" id="length" name="length" data-field="length" data-validate="required|positive|dimension" min="0.1" max="1000" step="0.1" aria-describedby="length-help">
                        <div id="length-help" class="sr-only">Enter the length of the concrete area in feet</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="width">Width (feet)</label>
                        <input type="number" id="width" name="width" data-field="width" data-validate="required|positive|dimension" min="0.1" max="1000" step="0.1" aria-describedby="width-help">
                        <div id="width-help" class="sr-only">Enter the width of the concrete area in feet</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="thickness">Thickness (inches)</label>
                        <input type="number" id="thickness" name="thickness" data-field="thickness" data-validate="required|positive|range:1,24" min="1" max="24" step="0.5" aria-describedby="thickness-help">
                        <div id="thickness-help" class="sr-only">Enter the thickness of concrete in inches (1-24 inches)</div>
                    </div>
                    
                    <div class="input-group">
                        <label for="pricePerYard">Price per Cubic Yard ($)</label>
                        <input type="number" id="pricePerYard" name="pricePerYard" data-field="pricePerYard" data-validate="required|positive|cost" min="50" max="500" step="5" aria-describedby="price-help">
                        <div id="price-help" class="sr-only">Enter the cost per cubic yard of concrete including delivery</div>
                    </div>
                    
                    <button type="button" class="btn" data-action="calculate" aria-describedby="calc-help">
                        Calculate Concrete Needs
                    </button>
                    <div id="calc-help" class="sr-only">Click to calculate concrete volume and costs</div>
                </div>
                
                <div>
                    <h2>Calculation Results</h2>
                    <div class="results" role="status" aria-live="polite" aria-label="Calculation results">
                        <div>Concrete Volume:</div>
                        <div class="result-main" id="volume" data-out="volume">Enter dimensions to calculate</div>
                        
                        <div id="results-details" style="display: none;">
                            <div class="result-row">
                                <span>With Waste Factor:</span>
                                <span id="totalVolume" data-out="totalVolume">0 cu yd</span>
                            </div>
                            <div class="result-row">
                                <span>Material Cost:</span>
                                <span id="materialCost" data-out="material">$0</span>
                            </div>
                            <div class="result-row">
                                <span>Estimated Labor:</span>
                                <span id="laborCost" data-out="labor">$0</span>
                            </div>
                            <div class="result-row">
                                <span>80lb Bags Needed:</span>
                                <span id="bags">0</span>
                            </div>
                            <div class="result-row">
                                <span>Concrete Trucks:</span>
                                <span id="trucks">0</span>
                            </div>
                            <div class="result-row">
                                <strong>Total Estimate:</strong>
                                <strong id="totalCost" data-out="total">$0</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button type="button" class="btn-secondary" data-action="save" onclick="saveCalculation()" aria-label="Save calculation to browser storage">
                            üíæ Save
                        </button>
                        <button type="button" class="btn-secondary" data-action="export" onclick="exportCSV()" aria-label="Export calculation as CSV file">
                            üìä Export
                        </button>
                        <button type="button" class="btn-secondary" data-action="share" onclick="shareCalculation()" aria-label="Generate shareable link">
                            üîó Share
                        </button>
                        <button type="button" class="btn-secondary" data-action="print" onclick="window.print()" aria-label="Print calculation results">
                            üñ®Ô∏è Print
                        </button>
                        <button data-action="email" aria-label="Email calculation results"><i class="fas fa-envelope" aria-hidden="true"></i> Email</button>
                    </div>

                    <div class="email-section" id="email-section" style="display: none; margin-top: 1rem;">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <input type="email" id="email-input" placeholder="Enter email address" aria-label="Email address" style="flex: 1; padding: 0.5rem;">
                            <input type="text" style="position: absolute; left: -9999px;" tabindex="-1" aria-hidden="true"> <!-- honeypot -->
                            <button id="send-email-btn" style="padding: 0.5rem 1rem;">Send Results</button>
                        </div>
                        <div id="email-status" style="margin-top: 0.5rem;"></div>
                    </div>
                </div>
            </form>
            
            <div class="disclaimer" role="region" aria-label="Important disclaimer">
                <strong>‚ö†Ô∏è Disclaimer:</strong> This calculator provides rough order of magnitude (ROM) estimates only. Actual costs vary by location, concrete type, site conditions, and market prices. Always get multiple quotes from licensed contractors for accurate pricing.
            </div>
        </div>
    </div>
    
    <!-- Core security and validation scripts loaded with defer -->
    <script src="/assets/js/secure-dom.js" defer></script>
    <script src="/assets/js/form-validation.js" defer></script>
    
    <script defer>
        let currentCalculation = {};
        
        // Optimized initialization with defer
        function initializeCalculator() {
            // Set default values
            document.getElementById('pourType').value = 'slab';
            document.getElementById('length').value = '30';
            document.getElementById('width').value = '20';
            document.getElementById('thickness').value = '4';
            document.getElementById('pricePerYard').value = '135';
            
            // Load shared data if present
            loadSharedData();
        }
        
        document.addEventListener('DOMContentLoaded', initializeCalculator);
        
        function calculateConcrete() {
            try {
                // Get form data
                const form = document.getElementById('concreteCalculator');
                const formData = new FormData(form);
                const inputs = Object.fromEntries(formData.entries());
                
                // Validate inputs using our secure validation system
                const validation = formValidator.validateCalculatorInputs(inputs, 'concrete');
                
                if (!validation.isValid) {
                    SecureDOM.displayFormErrors(validation.errors);
                    return;
                }
                
                // Parse values safely
                const pourType = inputs.pourType;
                const length = parseFloat(inputs.length) || 0;
                const width = parseFloat(inputs.width) || 0;
                const thickness = parseFloat(inputs.thickness) || 0;
                const pricePerYard = parseFloat(inputs.pricePerYard) || 135;
                
                // Waste factors by pour type
                const wasteFactors = {
                    slab: 1.05,
                    footing: 1.08,
                    wall: 1.10,
                    driveway: 1.07
                };
                
                // Calculate volume in cubic yards
                const cubicFeet = (length * width * thickness) / 12;
                const cubicYards = cubicFeet / 27;
                const totalVolume = cubicYards * wasteFactors[pourType];
                
                // Calculate costs
                const materialCost = totalVolume * pricePerYard;
                const laborCost = totalVolume * 65; // $65 per yard labor estimate
                const totalCost = materialCost + laborCost;
                
                // Calculate bags and trucks
                const bags = Math.ceil(totalVolume / 0.022); // 80lb bag = 0.022 cubic yards
                const trucks = Math.ceil(totalVolume / 10); // 10 yards per truck
                
                // Update display using secure DOM methods
                SecureDOM.setText('volume', `${cubicYards.toFixed(2)} cu yd`);
                SecureDOM.setText('totalVolume', `${totalVolume.toFixed(2)} cu yd`);
                SecureDOM.setText('materialCost', `$${materialCost.toFixed(0)}`);
                SecureDOM.setText('laborCost', `$${laborCost.toFixed(0)}`);
                SecureDOM.setText('bags', `${bags} bags`);
                SecureDOM.setText('trucks', `${trucks} ${trucks === 1 ? 'truck' : 'trucks'}`);
                SecureDOM.setText('totalCost', `$${totalCost.toFixed(0)}`);
                
                // Show results section
                document.getElementById('results-details').style.display = 'block';
                
                // Move focus to results for accessibility
                const resultsSection = document.querySelector('.results');
                if (resultsSection) {
                    resultsSection.setAttribute('tabindex', '-1');
                    resultsSection.focus();
                    setTimeout(() => resultsSection.removeAttribute('tabindex'), 100);
                }
                
                // Store calculation
                currentCalculation = {
                    pourType, length, width, thickness, pricePerYard,
                    volume: cubicYards, totalVolume, materialCost, laborCost, totalCost, bags, trucks,
                    timestamp: new Date().toISOString()
                };
                
                // Show success message
                SecureDOM.showNotification('Calculation completed successfully!', 'success', 3000);
                
            } catch (error) {
                console.error('Calculation error:', error);
                SecureDOM.showNotification('An error occurred during calculation. Please check your inputs.', 'error', 5000);
            }
        }
        
        function saveCalculation() {
            try {
                if (Object.keys(currentCalculation).length === 0) {
                    SecureDOM.showNotification('Please calculate first before saving.', 'info', 3000);
                    return;
                }
                
                localStorage.setItem('concreteCalc', JSON.stringify(currentCalculation));
                SecureDOM.showNotification('Calculation saved to browser storage!', 'success', 3000);
            } catch (error) {
                console.error('Save error:', error);
                SecureDOM.showNotification('Failed to save calculation. Please try again.', 'error', 3000);
            }
        }
        
        function exportCSV() {
            try {
                if (Object.keys(currentCalculation).length === 0) {
                    SecureDOM.showNotification('Please calculate first before exporting.', 'info', 3000);
                    return;
                }
                
                let csv = 'Parameter,Value\n';
                for (let [key, value] of Object.entries(currentCalculation)) {
                    // Sanitize values for CSV
                    const sanitizedKey = String(key).replace(/[,"\n\r]/g, '');
                    const sanitizedValue = String(value).replace(/[,"\n\r]/g, '');
                    csv += `${sanitizedKey},${sanitizedValue}\n`;
                }
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `concrete_calculation_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                SecureDOM.showNotification('CSV exported successfully!', 'success', 3000);
            } catch (error) {
                console.error('Export error:', error);
                SecureDOM.showNotification('Failed to export CSV. Please try again.', 'error', 3000);
            }
        }
        
        function shareCalculation() {
            try {
                if (Object.keys(currentCalculation).length === 0) {
                    SecureDOM.showNotification('Please calculate first before sharing.', 'info', 3000);
                    return;
                }
                
                // Create safe data object for sharing (exclude sensitive data)
                const shareData = {
                    pourType: currentCalculation.pourType,
                    length: currentCalculation.length,
                    width: currentCalculation.width,
                    thickness: currentCalculation.thickness,
                    pricePerYard: currentCalculation.pricePerYard
                };
                
                const data = btoa(JSON.stringify(shareData));
                const url = window.location.origin + window.location.pathname + '?data=' + data;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(url).then(() => {
                        SecureDOM.showNotification('Share link copied to clipboard!', 'success', 3000);
                    }).catch(() => {
                        fallbackCopyToClipboard(url);
                    });
                } else {
                    fallbackCopyToClipboard(url);
                }
            } catch (error) {
                console.error('Share error:', error);
                SecureDOM.showNotification('Failed to create share link. Please try again.', 'error', 3000);
            }
        }
        
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                SecureDOM.showNotification('Share link copied to clipboard!', 'success', 3000);
            } catch (err) {
                console.error('Clipboard copy failed:', err);
                SecureDOM.showNotification('Could not copy link. Please copy manually: ' + text, 'info', 10000);
            }
            
            document.body.removeChild(textArea);
        }
        
        function loadSharedData() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('data')) {
                try {
                    const data = JSON.parse(atob(params.get('data')));
                    
                    // Validate and sanitize shared data
                    if (data.pourType) document.getElementById('pourType').value = data.pourType;
                    if (data.length && !isNaN(data.length)) document.getElementById('length').value = data.length;
                    if (data.width && !isNaN(data.width)) document.getElementById('width').value = data.width;
                    if (data.thickness && !isNaN(data.thickness)) document.getElementById('thickness').value = data.thickness;
                    if (data.pricePerYard && !isNaN(data.pricePerYard)) document.getElementById('pricePerYard').value = data.pricePerYard;
                    
                    // Auto-calculate with shared data
                    calculateConcrete();
                    
                } catch (error) {
                    console.error('Failed to load shared data:', error);
                    SecureDOM.showNotification('Invalid share link data.', 'error', 3000);
                }
            }
        }
        
        // Screen reader support - optimized for performance
        function setupScreenReaderSupport() {
            document.querySelectorAll('.sr-only').forEach(el => {
                el.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0';
            });
        }
        
        document.addEventListener('DOMContentLoaded', setupScreenReaderSupport);
    </script>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">

<script>
// Lazy load methodology sections
document.addEventListener('DOMContentLoaded', function() {
    const lazyElements = document.querySelectorAll('.methodology-section, .disclaimer-section');
    
    if ('IntersectionObserver' in window) {
        const lazyObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('loaded');
                    lazyObserver.unobserve(entry.target);
                }
            });
        }, { rootMargin: '100px' });
        
        lazyElements.forEach(el => {
            el.style.opacity = '0';
            el.style.transition = 'opacity 0.3s';
            lazyObserver.observe(el);
        });
        
        // Add loaded class handler
        const style = document.createElement('style');
        style.textContent = '.methodology-section.loaded, .disclaimer-section.loaded { opacity: 1 !important; }';
        document.head.appendChild(style);
    }
});
</script>

<!-- Scripts loaded in optimal order for performance -->
<script src="/assets/js/calculators.js" defer></script>
<script src="/assets/js/export-utilities.js" defer></script>
<script src="/assets/js/calculators-hub.js" defer></script>
<script src="/assets/js/ga-init.js" defer></script>
</body>
</html>